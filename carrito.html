<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carrito de Compras - Librer√≠a Electr√≥nica IA</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Carrito de Compras</h1>
    <nav>
      <a href="index.html">Inicio</a>
      <a href="register.html">Registrarse</a>
      <a href="login.html">Iniciar Sesi√≥n</a>
      <a href="contacto.html">Contacto</a>
      <a href="carrito.html">üõí Carrito</a>
      <a href="terminos.html">T√©rminos</a>
      <a href="reembolso.html">Reembolso</a>
    </nav>
  </header>

  <main>
    <h2>üõí Carrito de Compras</h2>
    <div id="carrito-contenido"></div>
    <h3 id="total-carrito"></h3>
    <div id="boton-pago"></div>
    <button onclick="vaciarCarrito()">Vaciar carrito</button>
  </main>

  <footer>
    <p>&copy; 2025 Librer√≠a Electr√≥nica IA. Todos los derechos reservados.</p>
  </footer>

  <script>
  /* ===========================
     CARRITO CON LOCALSTORAGE + MONEDA + PAGOS
     =========================== */
  document.addEventListener("DOMContentLoaded", () => {
    renderCarrito();

    // Si el usuario cambia manualmente la moneda en otra p√°gina y vuelve, refrescamos
    const observer = new MutationObserver(renderCarrito);
    const currencySelect = document.getElementById("currency");
    if (currencySelect) observer.observe(currencySelect, { attributes: true, childList: true });
  });

  function renderCarrito() {
    const contenedor = document.getElementById("carrito-contenido");
    let carrito = JSON.parse(localStorage.getItem("carrito")) || [];

    if (carrito.length === 0) {
      contenedor.innerHTML = "<p>üõí El carrito est√° vac√≠o.</p>";
      document.getElementById("total-carrito").textContent = "";
      document.getElementById("boton-pago").innerHTML = "";
      return;
    }

    const monedaSeleccionada = localStorage.getItem("selectedCurrency") || "COP";
    const rate = (typeof exchangeRates !== "undefined" ? exchangeRates[monedaSeleccionada] : 1) || 1;

    let total = 0;
    contenedor.innerHTML = "";

    carrito.forEach((item, index) => {
      const precioConvertido = Math.round(item.precio / (exchangeRates[item.moneda] || 1) * rate);
      total += precioConvertido * item.cantidad;

      const div = document.createElement("div");
      div.classList.add("item-carrito");
      div.innerHTML = `
        <p><strong>${item.titulo}</strong><br>
        Autor: ${item.autor}<br>
        Precio: ${monedaSeleccionada} ${precioConvertido} √ó ${item.cantidad}</p>
        <button onclick="cambiarCantidad(${index}, 1)">Ôºã</button>
        <button onclick="cambiarCantidad(${index}, -1)">‚àí</button>
        <button onclick="eliminarItem(${index})">üóëÔ∏è</button>
      `;
      contenedor.appendChild(div);
    });

    document.getElementById("total-carrito").textContent =
      `Total: ${monedaSeleccionada} ${total.toFixed(2)}`;

    // Bot√≥n de pago din√°mico
    const botonPago = document.getElementById("boton-pago");
    if (monedaSeleccionada === "COP") {
      botonPago.innerHTML = `<button onclick="pagarWompi()">üí≥ Pagar con Wompi</button>`;
    } else {
      botonPago.innerHTML = `<button onclick="pagarPayPal()">üí≤ Pagar con PayPal</button>`;
    }
  }

  function cambiarCantidad(index, delta) {
    let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
    carrito[index].cantidad += delta;
    if (carrito[index].cantidad <= 0) carrito.splice(index, 1);
    localStorage.setItem("carrito", JSON.stringify(carrito));
    renderCarrito();
  }

  function eliminarItem(index) {
    let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
    carrito.splice(index, 1);
    localStorage.setItem("carrito", JSON.stringify(carrito));
    renderCarrito();
  }

  function vaciarCarrito() {
    localStorage.removeItem("carrito");
    renderCarrito();
  }

  /* ===========================
     BOTONES DE PAGO (Simulaci√≥n)
     =========================== */
  function pagarWompi() {
    alert("Redirigiendo a Wompi para completar el pago en COP...");
    // Aqu√≠ ir√≠a la integraci√≥n real con Wompi
  }

  function pagarPayPal() {
    alert("Redirigiendo a PayPal para completar el pago en moneda internacional...");
    // Aqu√≠ ir√≠a la integraci√≥n real con PayPal
  }
  </script>
</body>
</html>
